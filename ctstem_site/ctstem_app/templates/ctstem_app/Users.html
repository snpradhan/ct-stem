{% extends "ctstem_app/base.html" %}

{% block media %}
  {{ block.super }}
  {{ form.media }}
{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content">
    <h2> {{role|title}} </h2>
    <div class="form-group">
      {% if user.administrator or user.researcher %}
        <a type="button" class="btn btn-primary" href="{% url 'ctstem:register' %}" title="Add a new user">
          <span class="glyphicon glyphicon-user" aria-hidden="true"></span> Create User
        </a>
        <a type="button" class="btn btn-warning" href="/static/excel/User_Template.csv" title="Download User Template">
          <span class="glyphicon glyphicon-download" aria-hidden="true"></span> Download User Template
        </a>
        <a type="button" class="btn btn-success" href="#" data-toggle="modal" data-target="#upload" title="Upload Users">
          <span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Upload Users
        </a>
      {% elif user.teacher %}
        <a type="button" class="btn btn-primary" href="{% url 'ctstem:register' %}" title="Add a new user">
          <span class="glyphicon glyphicon-user" aria-hidden="true"></span> Create Student
        </a>
        <a type="button" class="btn btn-warning" href="/static/excel/Student_Template.csv" title="Download Student Template">
          <span class="glyphicon glyphicon-download" aria-hidden="true"></span> Download Student Template
        </a>
        <a type="button" class="btn btn-success" href="#" data-toggle="modal" data-target="#upload" title="Upload Students">
          <span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Upload Student
        </a>
      {% endif %}
    </div>
    <ul class="nav nav-tabs">
      {% if user.administrator %}
        <li {% if role == 'admins' %} class="active"{% endif %}><a href="{% url 'ctstem:users' 'admins' %}">Admins</a></li>
        <li {% if role == 'researchers' %} class="active"{% endif %}><a href="{% url 'ctstem:users' 'researchers' %}">Researchers</a></li>
        <li {% if role == 'authors' %} class="active"{% endif %}><a href="{% url 'ctstem:users' 'authors' %}">Content Authors</a></li>
      {% endif %}
      {% if user.administrator or user.researcher %}
        <li {% if role == 'teachers' %} class="active"{% endif %}><a href="{% url 'ctstem:users' 'teachers' %}">Teachers</a></li>
      {% endif %}
      {% if user.administrator or user.researcher or user.teacher %}
        <li {% if role == 'students' %} class="active"{% endif %}><a href="{% url 'ctstem:users' 'students' %}">Students</a></li>
      {% endif %}
    </ul>
    {% if users %}
      <table class="table table-striped table-bordered table-condensed dt" id="users">
        <thead>
          <tr>
            <th> Username </th>
            <th> Name </th>
            <th> Email </th>
            <th> Status </th>
            {% if role == 'researchers' or role == 'teachers' or role == 'students' %}
              <th> School </th>
            {% endif %}
            {% if role == 'researchers' or role == 'teachers' %}
              <th> User Code </th>
            {% endif %}
          </tr>
          <tr id="filterrow">
            <th> Username </th>
            <th> Name </th>
            <th> Email </th>
            <th> Status </th>
            {% if role == 'researchers' or role == 'teachers' or role == 'students' %}
              <th> School </th>
            {% endif %}
            {% if role == 'researchers' or role == 'teachers' %}
              <th> User Code </th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for userProfile in users %}
            <tr>
              <td>{{userProfile.user.username}}
                <div class="controls">
                  <a type="button" class="btn btn-success edit" aria-label="Edit User" title="Edit User" href="{% url 'ctstem:userProfile' userProfile.user.id %}">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                  </a>
                  <a type="button" class="btn btn-warning delete" aria-label="Delete User" title="Delete User" href="{% url 'ctstem:deleteUser' userProfile.user.id %}" onclick="return confirm('Are you sure you want to delete user {{userProfile.user.username}}?')">
                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                  </a>
                </div>
              </td>
              <td>{{userProfile.user.get_full_name}}</td>
              <td>{{userProfile.user.email}}</td>
              <td>{{userProfile.user.is_active|yesno:"Active,Inactive"}}</td>
              {% if role == 'researchers' or role == 'teachers' or role == 'students' %}
                <td>{{userProfile.school}}</td>
              {% endif %}
              {% if role == 'researchers' or role == 'teachers' %}
                <td>{{userProfile.user_code}}</td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No Users</p>
    {% endif %}
  </div>

  {% block upload %}
    <div class="modal fade" id="upload" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            {% if user.administrator or user.researcher %}
              <h3 class="modal-title">User Upload</h3>
            {% elif user.teacher %}
              <h3 class="modal-title">Student Upload</h3>
            {% endif %}
          </div>
          <div id="uploadMsg">
          </div>
          <form enctype="multipart/form-data" class="form" id="formUpload" method="post">
            {% csrf_token %}
            <div class="modal-body">
              <div class="form-group">
                <label for="id_uploadFile">File</label>
                {{uploadForm.uploadFile}}
              </div>
            </div>
            <div class="modal-footer">
              <div class="form-group button-row">
                <button type="submit" id="btnUpload" class="btn btn-success">
                  <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
                  Upload
                </button>
                <a type="button" class="btn btn-primary" data-dismiss="modal">Cancel</a>
              </div>

            </div>
          </form>
        </div>
      </div>
    </div>
  {% endblock %}
{% endblock %}


