{% extends "ctstem_app/base.html" %}
{% load ctstem_extras %}

{% block media %}
  {{ block.super }}
  {{ form.media }}
  <script src="https://code.highcharts.com/highcharts.js"></script>
{% endblock %}
{% block title %}Assignment Dashboard |{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content" id="dashboard">
    <h2> Assignment Dashboard </h2>
    {% include "ctstem_app/Tabs.html" with tab='assignment' group=assignment.group assignment=assignment role='assignment_dashboard'%}
    <table class="table table-striped table-bordered table-condensed inner_table" id="assignment_info">
      <thead>
        <tr>
          <th>Group</th>
          <th>Assignment</th>
          <th>Assigned Date</th>
          <th>Due Date </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="{% url 'ctstem:groupDashboard' assignment.group.id %}">{{assignment.group}}</a></td>
          <td>{{assignment.curriculum.title}}</td>
          <td>{{assignment.assigned_date|date}}</td>
          <td>{{assignment.due_date|date}}</td>
        </tr>
      </tbody>
    </table>
    {% if student_assignment_details %}
      <table class="table table-striped table-bordered table-condensed dt" id="student_assignment_details">
        <thead>
          <tr>
            <th width="20%"> Student Name </th>
            <th width="20%"> Teammates </th>
            <th width="15%"> Start Date </th>
            <th width="15%"> Last Modified </th>
            <th> Time Spent (hh:mm:ss) </th>
            <th width="10%"> Status </th>
            <th width="10%"> % Complete </th>
          </tr>
          <tr id="filterrow">
            <th> Student Name </th>
            <th> Teammates </th>
            <th> Start Date </th>
            <th> Last Modified </th>
            <th> Time Spent </th>
            <th> Status </th>
            <th> % Complete </th>
          </tr>
        </thead>
        <tbody>
          {% for student, assignment_details in student_assignment_details.items %}
            <tr>
              <td>
                {% if user.researcher %}
                  {{student.user.id}}
                {% else %}
                  {{student}}
                {% endif %}
              </td>
              <td>
                {% for teammate in assignment_details.instance.teammates.all %}
                  {{teammate}} <br>
                {% endfor %}
              </td>
              <td> {{assignment_details.instance.created_date|date}} </td>
              <td> {{assignment_details.instance.modified_date|date}} </td>
              <td> {{assignment_details.instance.time_spent|format_time}} </td>
              <td style="text-align: center;">
                {% if assignment_details.instance.status == 'P' %}
                  <div> In Progress </div>
                  <div>
                     <a type="button" class="btn btn-success" href="{% url 'ctstem:feedback' assignment.id  assignment_details.instance.id %}" title="Give Feedback"> <img src="/static/img/feedback.png" class="icon" /> </a>
                  </div>
                {% elif assignment_details.instance.status == 'S' %}
                  <div> Submitted </div>
                  <div>
                    <a type="button" class="btn btn-success" href="{% url 'ctstem:feedback' assignment.id  assignment_details.instance.id %}" title="Give Feedback"> <img src="/static/img/feedback.png" class="icon" /> </a>
                    <a type="button" class="btn btn-info" href="{% url 'ctstem:export_student_response' assignment.id  student.id %}" title="Export Student Response"> <span class="glyphicon glyphicon-export" aria-hidden="true"></span> </a>
                  </div>
                {% elif assignment_details.instance.status == 'F' %}
                  <div> Feedback Provided </div>
                  <div>
                    <a type="button" class="btn btn-default" href="{% url 'ctstem:feedback' assignment.id  assignment_details.instance.id %}" title="View Response/Feedback"> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> </a>
                    <a type="button" class="btn btn-info" href="{% url 'ctstem:export_student_response' assignment.id  student.id %}" title="Export Student Response"> <span class="glyphicon glyphicon-export" aria-hidden="true"></span> </a>
                  </div>
                {% elif assignment_details.instance.status == 'A' %}
                  <div> Archived </div>
                  <div>
                    <a type="button" class="btn btn-default" href="{% url 'ctstem:feedback' assignment.id  assignment_details.instance.id %}" title="View Response/Feedback"> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> </a>
                    <a type="button" class="btn btn-info" href="{% url 'ctstem:export_student_response' assignment.id  student.id %}" title="Export Student Response"> <span class="glyphicon glyphicon-export" aria-hidden="true"></span> </a>
                  </div>
                {% else %}
                  <div> New </div>
                {% endif %}
              </td>
              <td>
                <div id="chart_{{assignment_details.serial}}" class="chart" name={{assignment_details.percent_complete}}></div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No assignments available.</p>
    {% endif %}
  </div>

  <script type="text/javascript">
   /* $(".chart").each(function(){
      var id = $(this).attr('id');
      var percentage = $(this).attr('name');
      $("#"+id).circliful({
        animationStep: 10,
        foregroundBorderWidth: 25,
        backgroundBorderWidth: 25,
        percent: percentage,
        fontColor: '#000',
        foregroundColor: '#006000',
        text: 'Complete'
      });
    });*/
    $(".chart").each(function(){
      var id = $(this).attr('id');
      var complete = parseInt($(this).attr('name'));
      var remaining = 100-complete;
      $("#"+id).highcharts({
        chart: {
          type: 'pie',
          height:130,
          backgroundColor: 'rgba(0,0,0,0)',
        },
        title: {
          text: complete+'%',
          align: 'center',
          verticalAlign: 'middle',
          y: 0,
          style: {
            fontSize: '1.2em',
            color: 'black',
          },
        },
        tooltip: false,
        plotOptions: {
          pie: {
            dataLabels: {
              enabled: false,
            },
            startAngle: 0,
            endAngle: 360,
          }
        },
        credits: {
          enabled: false
        },
        series: [{
          type: 'pie',
          name: 'Work',
          innerSize: '80%',
          data: [
            {
              name: 'Complete',
              y: complete,
              color: 'green',
            },
            {
              name: 'Remaining',
              y: remaining,
              color: 'grey',
            },
          ]
        }]
      });
    });
  </script>

{% endblock %}


