{% extends "ctstem_app/base.html" %}
{% load ctstem_extras %}
{% block media %}
  {{ block.super }}
  {{ form.media }}
{% endblock %}
{% block title %}Classes |{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content {% if user.teacher %} teacher {% endif %}" id="classes">
    {% if user.teacher %}
      <h2> My Classes </h2>
    {% else %}
      <h2> Classes </h2>
    {% endif %}
     <form method="post">
      {% csrf_token %}
      {% include "ctstem_app/UserControls.html" with tab='group' %}
      {% include "ctstem_app/Tabs.html" with tab='group'%}

      {% if user.teacher %}
        <section class="portfolio">
          <div class="row">
            {% for group in groups %}
              <div class="col-lg-3 col-md-4 col-sm-6 portfolio-item ">
                <div class="tile">

                  <a href="{% url 'ctstem:group' group.id %}" class="portfolio-link">
                    <div class="portfolio-hover">
                      <div class="portfolio-hover-content">
                        <span class="glyphicon glyphicon-pencil gi-3x" aria-hidden="true"></span>
                      </div>
                    </div>
                    <div class="portfolio-icon">
                    {% if group.icon %}
                      <img src="{{group.icon.url}}" class="img-responsive" alt="">
                    {% elif group.subject and group.subject.icon %}
                      <img src="{{group.subject.icon.url}}" class="img-responsive" alt="">
                    {% else %}
                      <img src="/static/img/class.png" class="img-responsive group_icon_stock" alt="">
                    {% endif %}
                    </div>
                  </a>

                  <div class="portfolio-caption">
                    <input id="group_{{group.id}}" type="checkbox" class="action-select" value="{{group.id}}" name="group_{{group.id}}"/>
                    <div class="class_title">
                      {{group.title}}
                      {% if user.teacher in group.shared_with.all %}
                        <i class="fa fa-share-alt" title="Shared by {{group.teacher}}"></i>
                      {% endif %}
                    </div>

                    <div class="button_row">
                      {% if group.is_active %}
                        <div>
                          <a type="button" class="btn btn-yellow invite-modal" href="#" data-toggle="modal" data-target="#invite" data-invite-link="https://{{domain}}/?next=/preregister/group/{{group.group_code}}/" data-title="{{group.title}}" title="Student Invitation Link">
                            <i class="fa fa-link"></i>
                          </a>
                        </div>

                        <div>
                          <a type="button" class="btn btn-success upload-modal" href="#" data-toggle="modal" data-target="#upload" data-id="{{group.id}}" data-title="{{group.title}}" title="Add Students">
                            <i class="fa fa-user-plus"></i>
                          </a>
                        </div>
                        <div>
                          <a type="button" class="btn btn-warning" aria-label="Class Dashboard" title="Class Dashboard" href="{% url 'ctstem:groupDashboard' group.id %}">
                            <img src="/static/img/dashboard.png" class="icon" />
                          </a>
                        </div>
                         <div>
                          <a type="button" class="btn btn-info assignment-modal" href="#" data-toggle="modal" data-target="#assignment" data-id="{{group.id}}" title="Search and Add Assignments" data-title="{{group.title}}">
                            <i class="fa fa-tasks"></i>
                          </a>
                        </div>

                        <!--div>
                          <a type="button" class="btn btn-purple" aria-label="Inactivate Class" title="Inactivate Class" href="{% url 'ctstem:inactivateGroup' group.id %}" onclick="return confirm('Are you sure you want to inactivate {{group.title}}?')">
                              <i class="fa fa-archive"></i>
                          </a>
                        </div-->
                      {% else %}
                        <div>
                          <a type="button" class="btn btn-info" aria-label="Edit Class" title="Edit Class" href="{% url 'ctstem:group' group.id %}">
                            <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                          </a>
                        </div>
                        <div>
                          <a type="button" class="btn btn-warning" aria-label="Class Dashboard" title="Class Dashboard" href="{% url 'ctstem:groupDashboard' group.id %}">
                            <img src="/static/img/dashboard.png" class="icon" />
                          </a>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
            {% if group_status == 'active' %}
            <div class="col-lg-3 col-md-4 col-sm-6 portfolio-item ">
              <div class="tile">
                <a href="{% url 'ctstem:newGroup' %}" class="portfolio-link">
                   <div class="portfolio-hover">
                    <div class="portfolio-hover-content">
                      <span class="glyphicon glyphicon-plus gi-3x" aria-hidden="true"></span>
                    </div>
                  </div>
                  <div class="portfolio-icon">
                    <img src="/static/img/new_class.png" class="img-responsive group_icon_stock" alt="">
                  </div>
                </a>
                <div class="portfolio-caption">
                   <div class="class_title"><h3>ADD NEW CLASS</h3></div>
                </div>
              </div>
            </div>
            {% endif %}
          </div>
        </section>

      {% else %}
        {% if groups %}
          <table class="table table-striped table-bordered table-condensed dt" id="groups">
            <thead>
              <tr>
                <th width="1%" class="no-sort"><input id="select-all" type="checkbox" value="0" name="select-all"/></th>
                <th width="20%"> Class Name </th>
                <th width="10%"> Subject </th>
                <th width="10%"> Time </th>
                <th> Status </th>
                {% if not user.teacher %}
                  <th width="15%"> Teacher </th>
                {% endif %}
                <th width="15%">Co-teachers</th>
                {% if not user.teacher and not user.school_administrator %}
                  <th width="15%"> School </th>
                {% endif %}
                <th> Students </th>
                <th> Assignments </th>
                <th width="10%"> Created <br> Modified <br> Last Login</th>
              </tr>
              <tr id="filterrow">
                <th class="no-sort"></th>
                <th> Class Name </th>
                <th> Subject </th>
                <th> Time </th>
                <th> Status </th>
                {% if not user.teacher %}
                  <th> Teacher </th>
                {% endif %}
                <th>Co-teachers</th>
                {% if not user.teacher and not user.school_administrator %}
                  <th width="15%"> School </th>
                {% endif %}
                <th> Students </th>
                <th> Assignments </th>
                <th> Created <br> Modified <br> Last Login</th>
              </tr>
            </thead>
            <tbody>
              {% for group in groups %}
                <tr>
                  <td>
                    <input id="group_{{group.id}}" type="checkbox" class="action-select" value="{{group.id}}" name="group_{{group.id}}" />
                  </td>
                  <td class="title">
                    {{group.title}}
                    {% if not user.researcher %}
                      <div class="controls">
                        <a type="button" class="btn btn-info" aria-label="Edit Class" title="Edit Class" href="{% url 'ctstem:group' group.id %}">
                            {% if group.is_active %}
                              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            {% else %}
                              <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                            {% endif %}
                        </a>
                        {% if group.is_active %}
                          <a type="button" class="btn btn-yellow invite-modal" href="#" data-toggle="modal" data-target="#invite" data-invite-link="https://{{domain}}/?next=/preregister/group/{{group.group_code}}/" data-title="{{group.title}}" title="Student Invitation Link">
                            <i class="fa fa-link"></i>
                          </a>
                          <a type="button" class="btn btn-success upload-modal" href="#" data-toggle="modal" data-target="#upload" data-id="{{group.id}}" data-title="{{group.title}}" title="Upload Students">
                            <i class="fa fa-user-plus"></i>
                          </a>
                          <a type="button" class="btn btn-purple" aria-label="Inactivate Class" title="Inactivate Class" href="{% url 'ctstem:inactivateGroup' group.id %}" onclick="return confirm('Are you sure you want to inactivate {{group.title}}?')">
                              <i class="fa fa-archive"></i>
                          </a>
                          <a type="button" class="btn btn-danger" aria-label="Delete Class" title="Delete Class" href="{% url 'ctstem:deleteGroup' group.id %}" onclick="return confirm('Are you sure you want to delete {{group.title}}?')">
                              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                          </a>
                        {% endif %}
                      </div>
                    {% endif %}
                  </td>
                  <td>{{group.subject}}</td>
                  <td>{{group.time}}</td>
                  <td>{{group.is_active|yesno:"Active,Inactive"}}</td>
                  {% if not user.teacher %}
                    <td>{{group.teacher}}</td>
                  {% endif %}
                  <td>
                    {% for coteacher in group.shared_with.all %}
                      <div>{{coteacher}}</div>
                    {% endfor %}
                  </td>
                  {% if not user.teacher and not user.school_administrator %}
                    <td> {{group.teacher.school}} </td>
                  {% endif %}
                  <td>
                     <div>
                      {% if group.members.count > 0 %}
                        {{group.members.count}} Members
                      {% else %}
                        No Member
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    <div>
                      {% if group.assignments.count > 0 %}
                        {{group.assignments.count}} Assignments
                        <div>
                          <a type="button" class="btn btn-warning" href="{% url 'ctstem:groupDashboard' group.id %}" aria-label="View Class Dashboard" title="View Class Dashboard">
                            <img src="/static/img/dashboard.png" class="icon" />
                          </a>
                      {% else %}
                        No Assignment
                        <div>

                      {% endif %}
                        <a type="button" class="btn btn-info assignment-modal" href="#" data-toggle="modal" data-target="#assignment" data-id="{{group.id}}" data-title="{{group.title}}" data-subject="{{group.subject.id}}" title="Search and Add Assignments">
                            <i class="fa fa-tasks"></i>
                          </a>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div>Cr: {{group.created_date|date}}</div>
                    <div>Mo: {{group.modified_date|date}}</div>
                    <div>LL: {{group|class_last_login|date}}</div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

        {% else %}
          <p>No classes available.</p>
        {% endif %}
      {% endif %}
    </form>
  </div>
  {% block upload %}
    {% include "ctstem_app/UserUploadModal.html" %}
  {% endblock %}
  {% block invite %}
    {% include "ctstem_app/InviteModal.html" %}
  {% endblock %}
  {% block assignment %}
    {% include "ctstem_app/AssignmentSearch.html" %}
  {% endblock %}

  <script type="text/javascript">
    $(function(){
      $(".expand_collapse2").click(function(){
        $(this).next().toggle();
        $(this).children().each(function(){
          $(this).toggle();
        })
      });

      $('a.invite-modal').click(function(){
        $("div.modal#invite .modal-title span").html($(this).data('title'));
        $("div.modal#invite .modal-body .link").html($(this).data('invite-link'));
      });

      $('div.portfolio-select').on('click', function(){
        $(this).find('input[type="hidden"][id^="group"]')
      });
    });

  </script>

{% endblock %}


