{% extends "ctstem_app/base.html" %}

{% block media %}
  {{ block.super }}
  {{ form.media }}
{% endblock %}
{% block title %}Classes |{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content" id="classes">
    {% if user.teacher %}
      <h2> My Classes </h2>
    {% else %}
      <h2> Classes </h2>
    {% endif %}
     <form method="post">
      {% csrf_token %}
      {% include "ctstem_app/UserControls.html" with tab='group' %}
      {% include "ctstem_app/Tabs.html" with tab='group'%}

      {% if user.teacher %}
        {% if groups %}
          <section class="portfolio">
            <div class="row">
              {% for group in groups %}
                <div class="col-lg-4 col-md-6 portfolio-item ">
                  <div class="tile">
                    <div class="portfolio-caption">
                        <input id="group_{{group.id}}" type="checkbox" class="action-select" value="{{group.id}}" name="group_{{group.id}}"/>
                        <div class="class_title">{{group.title}}</div>

                        <div class="row details">
                            <div class="row">
                              <div class="col-md-6 title">Subject:</div>
                              <div class="col-md-6 value">{{group.subject|default_if_none:""}}</div>
                            </div>
                            <div class="row">
                              <div class="col-md-6 title">Time:</div>
                              <div class="col-md-6 value">{{group.time|default_if_none:""}}</div>
                            </div>
                            <div class="row">
                              <div class="col-md-6 title">No. of Students:</div>
                              <div class="col-md-6 value">{{group.members.count}}</div>
                            </div>
                            <div class="row">
                              <div class="col-md-6 title">No. of Assignments:</div>
                              <div class="col-md-6 value">{{group.assignments.count}}</div>
                            </div>
                        </div>

                      <div class="row">
                        {% if group.is_active %}
                          <div class="col-md-3">
                            <a type="button" class="btn btn-info" aria-label="Edit Group" title="Edit Class" href="{% url 'ctstem:group' group.id %}">
                              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a type="button" class="btn btn-danger" aria-label="Delete Group" title="Delete Class" href="{% url 'ctstem:deleteGroup' group.id %}" onclick="return confirm('Are you sure you want to delete {{group.title}}?')">
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a type="button" class="btn btn-success upload-modal" href="#" data-toggle="modal" data-target="#upload" data-id="{{group.id}}" data-title="{{group.title}}" title="Add Students">
                              <i class="fa fa-user-plus"></i>
                            </a>
                          </div>
                          <div class="col-md-3">
                            <a type="button" class="btn btn-warning" aria-label="Edit Group" title="Class Dashboard" href="{% url 'ctstem:groupDashboard' group.id %}">
                              <img src="/static/img/dashboard.png" class="icon" />
                            </a>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </section>
        {% endif %}

      {% else %}
        {% if groups %}
          <table class="table table-striped table-bordered table-condensed dt" id="groups">
            <thead>
              <tr>
                <th width="1%" class="no-sort"><input id="select-all" type="checkbox" value="0" name="select-all"/></th>
                <th width="20%"> Group Name </th>
                <th width="15%"> Subject </th>
                <th width="10%"> Time </th>
                <th> Status </th>
                {% if not user.teacher %}
                  <th width="15%"> Teacher </th>
                {% endif %}
                {% if not user.teacher and not user.school_administrator %}
                  <th width="15%"> School </th>
                {% endif %}
                <th> Students </th>
                <th> Assignments </th>
              </tr>
              <tr id="filterrow">
                <th class="no-sort"></th>
                <th> Group Name </th>
                <th> Subject </th>
                <th> Time </th>
                <th> Status </th>
                {% if not user.teacher %}
                  <th> Teacher </th>
                {% endif %}
                {% if not user.teacher and not user.school_administrator %}
                  <th width="15%"> School </th>
                {% endif %}
                <th> Students </th>
                <th> Assignments </th>
              </tr>
            </thead>
            <tbody>
              {% for group in groups %}
                <tr>
                  <td>
                    <input id="group_{{group.id}}" type="checkbox" class="action-select" value="{{group.id}}" name="group_{{group.id}}" />
                  </td>
                  <td class="title">
                    {{group.title}}
                    {% if not user.researcher %}
                      <div class="controls">
                        <a type="button" class="btn btn-info" aria-label="Edit Group" title="Edit Group" href="{% url 'ctstem:group' group.id %}">
                            {% if group.is_active %}
                              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            {% else %}
                              <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                            {% endif %}
                        </a>
                        {% if group.is_active %}
                          <a type="button" class="btn btn-danger" aria-label="Delete Group" title="Delete Group" href="{% url 'ctstem:deleteGroup' group.id %}" onclick="return confirm('Are you sure you want to delete {{group.title}}?')">
                              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                          </a>
                          <a type="button" class="btn btn-success upload-modal" href="#" data-toggle="modal" data-target="#upload" data-id="{{group.id}}" data-title="{{group.title}}" title="Upload Students">
                            <i class="fa fa-user-plus"></i>
                          </a>
                        {% endif %}
                      </div>
                    {% endif %}
                  </td>
                  <td>{{group.subject}}</td>
                  <td>{{group.time}}</td>
                  <td>{{group.is_active|yesno:"Active,Inactive"}}</td>
                  {% if not user.teacher %}
                    <td>{{group.teacher}}</td>
                  {% endif %}
                  {% if not user.teacher and not user.school_administrator %}
                    <td> {{group.teacher.school}} </td>
                  {% endif %}
                  <td>
                     <div>
                      {% if group.members.count > 0 %}
                        {{group.members.count}} Members
                      {% else %}
                        No Member
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    <div>
                      {% if group.assignments.count > 0 %}
                        {{group.assignments.count}} Assignments
                        <div>
                          <a type="button" class="btn btn-warning" href="{% url 'ctstem:groupDashboard' group.id %}" aria-label="View Group Dashboard" title="View Group Dashboard">
                            <img src="/static/img/dashboard.png" class="icon" />
                          </a>
                        </div>
                      {% else %}
                        No Assignment
                      {% endif %}
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

        {% else %}
          <p>No classes available.</p>
        {% endif %}
      {% endif %}
    </form>
  </div>
  {% block upload %}
    {% include "ctstem_app/UserUploadModal.html" %}
  {% endblock %}

  <script type="text/javascript">
    $(function(){
      $(".expand_collapse2").click(function(){
        $(this).next().toggle();
        $(this).children().each(function(){
          $(this).toggle();
        })
      });

      $('a.upload-modal').click(function(){
        $("div.modal#upload select#id_group option:selected").prop('selected', false);
        $("div.modal#upload select#id_group option[value='"+$(this).data('id')+"']").prop('selected', true);

        var title = 'Class';
        if($(this).data('title') !== undefined){
          title = '<div>'+$(this).data('title')+'</div>';
        }
        $("div.modal#upload .modal-title span").html(title);

        if($(this).data('id') != null){
          $("div.modal#upload select#id_group").closest('.form-group').hide();
        }
        else{
          $("div.modal#upload select#id_group").closest('.form-group').show();
        }
      });

      $('div.portfolio-select').on('click', function(){
        $(this).find('input[type="hidden"][id^="group"]')
      });
    });

  </script>

{% endblock %}


