{% extends "ctstem_app/base.html" %}

{% block media %}
  {{ block.super }}
  {{ form.media }}
{% endblock %}
{% block title %}User Groups |{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content">
    {% if user.teacher %}
      <h2> My Student Groups </h2>
    {% else %}
      <h2> Student Groups </h2>
    {% endif %}
    <div class="btn-group">
      <a type="button" class="btn btn-info" href="{% url 'ctstem:newGroup' %}" title="Create new group">Create Group</a>
    </div>

    {% if groups %}
      <table class="table table-striped table-bordered table-condensed dt" id="groups">
        <thead>
          <tr>
            <th width="20%"> Group Name </th>
            <th width="15%"> Subject </th>
            <th width="10%"> Time </th>
            <th width="15%"> Teacher </th>
            <th> Students </th>
            <th> Assignments </th>
          </tr>
          <tr id="filterrow">
            <th> Group Name </th>
            <th> Subject </th>
            <th> Time </th>
            <th> Teacher </th>
            <th> Students </th>
            <th> Assignments </th>
          </tr>
        </thead>
        <tbody>
          {% for group in groups %}
            <tr>
              <td class="title">
                {{group.title}}
                <a type="button" class="btn btn-success" aria-label="Edit Group" title="Edit Group" href="{% url 'ctstem:group' group.id %}">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </a>
                <a type="button" class="btn btn-danger" aria-label="Delete Group" title="Delete Group" href="{% url 'ctstem:deleteGroup' group.id %}">
                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                </a>
              </td>
              <td>{{group.subject}}</td>
              <td>{{group.time}}</td>
              <td>{{group.teacher}}</td>
              <td>
                {% if group.members.count > 0 %}
                  <ul>
                    <li>{{group.members.count}}
                      <span class="ec">
                        <span class="glyphicon glyphicon-collapse-up" aria-hidden="true" style="display:none;"></span>
                        <span class="glyphicon glyphicon-collapse-down" aria-hidden="true"></span>
                      </span>
                    </li>
                    <ul class="members" style="display:none;">
                      {% for member in group.members.all %}
                        <li>{{member}}</li>
                      {% endfor %}
                    </ul>
                  </ul>
                {% else %}
                  <ul>
                    <li>{{group.members.count}}</li>
                  </ul>
                {% endif %}
              </td>
              <td>
                {% if group.assignments.count > 0 %}
                  <ul>
                    <li>{{group.assignments.count}}
                      <span class="ec">
                        <span class="glyphicon glyphicon-collapse-up" aria-hidden="true" style="display:none;"></span>
                        <span class="glyphicon glyphicon-collapse-down" aria-hidden="true"></span>
                      </span>
                    </li>
                    <ul class="members" style="display:none;">
                      {% for assignment in group.assignments.all %}
                        <li>{{assignment.assessment}}</li>
                      {% endfor %}
                    </ul>
                  </ul>
                {% else %}
                  <ul>
                    <li>{{group.assignments.count}}</li>
                  </ul>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No groups available.</p>
    {% endif %}
  </div>

  <script type="text/javascript">
    $(".expand_collapse2").click(function(){
        $(this).next().toggle();
        $(this).children().each(function(){
          $(this).toggle();
        })
      });
  </script>

{% endblock %}


