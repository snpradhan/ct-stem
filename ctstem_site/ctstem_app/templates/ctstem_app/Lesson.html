{% extends "ctstem_app/base.html" %}
{% load ctstem_extras %}

{% block title %}Lesson |{% endblock %}
{% block media %}
  {{block.super}}
  {% load wysiwyg %}

  {% wysiwyg_setup %}
  {% include "ctstem_app/django_wysiwyg_includes.html" %}
{% endblock %}

{% block content %}
  {{block.super}}
  <div class="content">
    <h2>Lesson</h2>
    <form method="post">
      {% csrf_token %}
      <div class="table" id="lesson">
        {{form.management_form}}
        {% for field in form %}
          <div class="form-group">
            <label for="id_{{field.name}}">{{ field.label }} {% if field.field.required %}(<span class="required">*</span>) {% endif %}</label>
            {% if field.name == 'questions' %}
              <div class="clearfix">
                {{field}}
              </div>
            {% elif field.name == 'content' %}
              <div>
                {{field}}
                {% wysiwyg_editor "id_lesson-content" %}
              </div>
            {% elif field.name == 'teacher_notes' %}
              <div>
                {{field}}
                {% wysiwyg_editor "id_lesson-teacher_notes" %}
              </div>
            {% else %}
              <div>
                {{field}}
              </div>
            {% endif %}
            <div class="error">{{ field.errors }}</div>
          </div>
        {% endfor %}
      </div>

      <div class="table" id="lessonQuestions">
        <h3>Activity Questions</h3>
        {{formset.management_form}}
        <table class="table table-striped table-condensed lessonQuestion">
          <thead>
            <tr>
              <th></th>
              <th style="width:60%;">Question</th>
              <th>Edit</th>
              <th>Order</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            {% for questionForm in formset %}
              <tr style="{% if forloop.last %} display:none; {% endif %}" id="question_row_{{questionForm.question.value}}">
                <td class="question_order">
                  {{form.id}}
                  {{questionForm.id}}
                  <div>
                    Q{{questionForm.ORDER.value}}.
                  </div>
                </td>
                <td class="question_text">
                  {% if questionForm.question.value and questionForm.question.value != 'None' %}
                    <input type="hidden" class="question_id" id="{{questionForm.question.auto_id}}" name="{{questionForm.question.html_name}}" value="{{questionForm.question.value}}"/>
                    <div> {{questionForm.question.value|selected_question|safe }} </div>

                  {% else %}
                    <input type="hidden" class="question_id" id="{{questionForm.question.auto_id}}" name="{{questionForm.question.html_name}}" value/>
                  {% endif %}
                </td>
                <td>
                  <button type="button" class="btn btn-default edit_question" name="edit_question" aria-label="Edit Question" data-form="{% url 'ctstem:question' questionForm.question.value|default:0 %}">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                  </button>
                </td>
                <td>{{questionForm.ORDER }}</td>
                <td>{{questionForm.DELETE }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="form-group button-group-fixed">
          <input type="submit" class="btn btn-success" id="submit" value="Save"/>
          <button class="btn btn-primary edit_question" data-form="{% url 'ctstem:newQuestion' %}">Add Question</button>
        </div>
    </form>
    <div class="modal fade" id="questionModal" role="dialog">
    </div>
  </div>
  <script type="text/javascript">
    $(function (){
      $("button.edit_question").click(function(e){
        e.preventDefault();
        var url = $(this).data("form");
        $("#questionModal").load(url, function() {
          $(this).modal('show');
        });
        return false;
      });
    });
  </script>

{% endblock %}
